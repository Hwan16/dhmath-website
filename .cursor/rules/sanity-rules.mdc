---
alwaysApply: false
---

# Sanity CMS ì‚¬ìš© ê·œì¹™

## ì ìš© ëŒ€ìƒ
Sanity ê´€ë ¨ ëª¨ë“  íŒŒì¼ (`sanity/**`, `lib/sanity/**`)

## í™˜ê²½ ë³€ìˆ˜
```env
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NEXT_PUBLIC_SANITY_DATASET=production
SANITY_API_TOKEN=your_api_token  # ì„œë²„ ì „ìš© (ë¯¸ë¦¬ë³´ê¸°ìš©)
```

## Sanity í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
```tsx
// lib/sanity/client.ts
import { createClient } from 'next-sanity';
import imageUrlBuilder from '@sanity/image-url';

export const client = createClient({
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET!,
  apiVersion: '2024-01-01',
  useCdn: true, // í”„ë¡œë•ì…˜ì—ì„œëŠ” true
});

// ì´ë¯¸ì§€ URL ë¹Œë”
const builder = imageUrlBuilder(client);

export function urlFor(source: any) {
  return builder.image(source);
}
```

## ìŠ¤í‚¤ë§ˆ ì •ì˜

### Post (ì•„í‹°í´/ì…ì‹œì „ëµ)
```tsx
// sanity/schemas/post.ts
import { defineField, defineType } from 'sanity';

export default defineType({
  name: 'post',
  title: 'ê²Œì‹œê¸€',
  type: 'document',
  fields: [
    defineField({
      name: 'title',
      title: 'ì œëª©',
      type: 'string',
      validation: (Rule) => Rule.required().max(100),
    }),
    defineField({
      name: 'slug',
      title: 'URL ìŠ¬ëŸ¬ê·¸',
      type: 'slug',
      options: {
        source: 'title',
        maxLength: 96,
      },
      validation: (Rule) => Rule.required(),
    }),
    defineField({
      name: 'category',
      title: 'ì¹´í…Œê³ ë¦¬',
      type: 'string',
      options: {
        list: [
          { title: 'ì•„í‹°í´', value: 'article' },
          { title: 'ì…ì‹œ ì „ëµ', value: 'strategy' },
        ],
        layout: 'radio',
      },
      validation: (Rule) => Rule.required(),
    }),
    defineField({
      name: 'thumbnail',
      title: 'ì¸ë„¤ì¼ ì´ë¯¸ì§€',
      type: 'image',
      options: {
        hotspot: true,
      },
    }),
    defineField({
      name: 'excerpt',
      title: 'ìš”ì•½',
      type: 'text',
      rows: 3,
      validation: (Rule) => Rule.max(200),
    }),
    defineField({
      name: 'body',
      title: 'ë³¸ë¬¸',
      type: 'blockContent',
    }),
    defineField({
      name: 'isPinned',
      title: 'ìƒë‹¨ ê³ ì •',
      type: 'boolean',
      initialValue: false,
    }),
    defineField({
      name: 'publishedAt',
      title: 'ë°œí–‰ì¼',
      type: 'datetime',
    }),
  ],
  preview: {
    select: {
      title: 'title',
      category: 'category',
      media: 'thumbnail',
    },
    prepare({ title, category, media }) {
      const categoryLabel = category === 'article' ? 'ğŸ“ ì•„í‹°í´' : 'ğŸ¯ ì…ì‹œ ì „ëµ';
      return {
        title,
        subtitle: categoryLabel,
        media,
      };
    },
  },
});
```

### Block Content (ë¦¬ì¹˜ í…ìŠ¤íŠ¸)
```tsx
// sanity/schemas/blockContent.ts
import { defineType, defineArrayMember } from 'sanity';

export default defineType({
  name: 'blockContent',
  title: 'Block Content',
  type: 'array',
  of: [
    defineArrayMember({
      type: 'block',
      styles: [
        { title: 'ë³¸ë¬¸', value: 'normal' },
        { title: 'ì œëª© 1', value: 'h1' },
        { title: 'ì œëª© 2', value: 'h2' },
        { title: 'ì œëª© 3', value: 'h3' },
        { title: 'ì¸ìš©êµ¬', value: 'blockquote' },
      ],
      marks: {
        decorators: [
          { title: 'êµµê²Œ', value: 'strong' },
          { title: 'ê¸°ìš¸ì„', value: 'em' },
          { title: 'ë°‘ì¤„', value: 'underline' },
          { title: 'í˜•ê´‘íœ', value: 'highlight' },
        ],
        annotations: [
          {
            name: 'link',
            type: 'object',
            title: 'ë§í¬',
            fields: [
              {
                name: 'href',
                type: 'url',
                title: 'URL',
              },
            ],
          },
        ],
      },
    }),
    defineArrayMember({
      type: 'image',
      options: { hotspot: true },
    }),
    defineArrayMember({
      type: 'youtube',
    }),
  ],
});
```

### YouTube ì„ë² ë“œ
```tsx
// sanity/schemas/youtube.ts
import { defineType } from 'sanity';

export default defineType({
  name: 'youtube',
  title: 'YouTube ì˜ìƒ',
  type: 'object',
  fields: [
    {
      name: 'url',
      title: 'YouTube URL',
      type: 'url',
    },
  ],
  preview: {
    select: { url: 'url' },
    prepare({ url }) {
      return {
        title: 'YouTube ì˜ìƒ',
        subtitle: url,
      };
    },
  },
});
```

## GROQ ì¿¼ë¦¬

### ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
```tsx
// lib/sanity/queries.ts
import { groq } from 'next-sanity';

// ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ëª©ë¡ (ê³ ì •ê¸€ ë¨¼ì €, ê·¸ ë‹¤ìŒ ìµœì‹ ìˆœ)
export const postsQuery = groq`
  *[_type == "post" && category == $category] | order(isPinned desc, publishedAt desc) {
    _id,
    title,
    slug,
    excerpt,
    thumbnail,
    isPinned,
    publishedAt
  }
`;

// ìµœì‹  ê²Œì‹œê¸€ (í™ˆí˜ì´ì§€ìš©)
export const recentPostsQuery = groq`
  *[_type == "post" && category == $category] | order(isPinned desc, publishedAt desc)[0...$limit] {
    _id,
    title,
    slug,
    excerpt,
    thumbnail,
    isPinned,
    publishedAt
  }
`;

// ë‹¨ì¼ ê²Œì‹œê¸€ ìƒì„¸
export const postDetailQuery = groq`
  *[_type == "post" && slug.current == $slug][0] {
    _id,
    title,
    category,
    thumbnail,
    body,
    publishedAt,
    "previousPost": *[_type == "post" && category == ^.category && publishedAt < ^.publishedAt] | order(publishedAt desc)[0] {
      title,
      slug
    },
    "nextPost": *[_type == "post" && category == ^.category && publishedAt > ^.publishedAt] | order(publishedAt asc)[0] {
      title,
      slug
    }
  }
`;
```

### ë°ì´í„° í˜ì¹­ í•¨ìˆ˜
```tsx
// lib/sanity/fetch.ts
import { client } from './client';
import { postsQuery, recentPostsQuery, postDetailQuery } from './queries';
import type { Post, PostDetail } from '@/types';

export async function getPosts(category: 'article' | 'strategy'): Promise<Post[]> {
  return client.fetch(postsQuery, { category });
}

export async function getRecentPosts(
  category: 'article' | 'strategy',
  limit: number = 3
): Promise<Post[]> {
  return client.fetch(recentPostsQuery, { category, limit });
}

export async function getPostDetail(slug: string): Promise<PostDetail | null> {
  return client.fetch(postDetailQuery, { slug });
}
```

## Portable Text ë Œë”ë§
```tsx
// components/features/articles/portable-text.tsx
import { PortableText } from '@portabletext/react';
import Image from 'next/image';
import { urlFor } from '@/lib/sanity/client';

const components = {
  types: {
    image: ({ value }: any) => (
      <figure className="my-8">
        <Image
          src={urlFor(value).width(800).url()}
          alt={value.alt || ''}
          width={800}
          height={450}
          className="rounded-lg"
        />
        {value.caption && (
          <figcaption className="text-center text-sm text-gray-500 mt-2">
            {value.caption}
          </figcaption>
        )}
      </figure>
    ),
    youtube: ({ value }: any) => {
      const videoId = extractYouTubeId(value.url);
      return (
        <div className="my-8 aspect-video">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}?rel=0`}
            className="w-full h-full rounded-lg"
            allowFullScreen
          />
        </div>
      );
    },
  },
  marks: {
    link: ({ children, value }: any) => (
      <a
        href={value.href}
        target="_blank"
        rel="noopener noreferrer"
        className="text-pink-500 hover:text-pink-600 underline"
      >
        {children}
      </a>
    ),
    highlight: ({ children }: any) => (
      <mark className="bg-yellow-200 px-1 rounded">{children}</mark>
    ),
  },
  block: {
    h1: ({ children }: any) => (
      <h1 className="text-3xl font-bold mt-8 mb-4">{children}</h1>
    ),
    h2: ({ children }: any) => (
      <h2 className="text-2xl font-bold mt-6 mb-3">{children}</h2>
    ),
    h3: ({ children }: any) => (
      <h3 className="text-xl font-bold mt-4 mb-2">{children}</h3>
    ),
    blockquote: ({ children }: any) => (
      <blockquote className="border-l-4 border-pink-400 pl-4 my-4 italic text-gray-600">
        {children}
      </blockquote>
    ),
  },
};

export function PostBody({ body }: { body: any }) {
  return (
    <article className="prose prose-lg max-w-none">
      <PortableText value={body} components={components} />
    </article>
  );
}

// YouTube URLì—ì„œ ID ì¶”ì¶œ
function extractYouTubeId(url: string): string {
  const match = url.match(
    /(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([^&?\/]+)/
  );
  return match?.[1] || '';
}
```

## ì´ë¯¸ì§€ ìµœì í™”
```tsx
// ì¸ë„¤ì¼ ì´ë¯¸ì§€
urlFor(thumbnail).width(400).height(225).fit('crop').url()

// ë³¸ë¬¸ ì´ë¯¸ì§€
urlFor(image).width(800).quality(80).url()

// í”„ë¡œí•„ ì´ë¯¸ì§€
urlFor(profile).width(200).height(200).fit('crop').url()
```

## íƒ€ì… ì •ì˜
```tsx
// types/sanity.ts
export interface Post {
  _id: string;
  title: string;
  slug: { current: string };
  excerpt?: string;
  thumbnail?: SanityImage;
  isPinned: boolean;
  publishedAt: string;
}

export interface PostDetail extends Post {
  category: 'article' | 'strategy';
  body: any[]; // Portable Text
  previousPost?: { title: string; slug: { current: string } };
  nextPost?: { title: string; slug: { current: string } };
}

export interface SanityImage {
  _type: 'image';
  asset: {
    _ref: string;
  };
}
```
